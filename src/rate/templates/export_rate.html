{% extends "base.html" %}

{% block title %}Export Rate Data — DMS Inc.{% endblock %}

{% block content %}

<!-- =============================================== -->
<!-- PRINT CSS: Makes window.print() look like a PDF -->
<!-- =============================================== -->
<style>
  @media print {
    /* Hide EVERYTHING on the page */
    body * {
      visibility: hidden;
    }

    /* Only show the print area content */
    #print-area,
    #print-area * {
      visibility: visible;
    }

    /* Position the print area at the top for PDF output */
    #print-area {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }

    /* Remove shadows/borders so PDF looks clean */
    .card.export-card {
      box-shadow: none !important;
      border: none !important;
    }
  }
</style>

<!-- Everything inside #print-area will appear in the PDF -->
<main class="content-narrow" id="print-area">

  <!-- ============================= -->
  <!-- Card: Main Rating Summary -->
  <!-- ============================= -->
  <section class="card export-card">

    <!-- Small muted header -->
    <p class="muted">Culvert rating summary</p>

    <!-- Page title -->
    <h1>Your rating</h1>

    <!-- Key badge showing rating number -->
    <p style="margin: 0.5rem 0;">
      <span style="
          display:inline-block;
          padding:0.2rem 0.9rem;
          border-radius:999px;
          border:1px solid rgba(148,163,184,0.6);
          font-size:1.2rem;
          font-weight:600;
        ">
        {{ overall_rating or 5 }}
      </span>
    </p>

    <!-- Main condition description -->
    <p class="lead">
      {{ condition_label or "S minus is in very good condition." }}
    </p>

    <!-- ============================= -->
    <!-- Model Outputs (RF + XGBoost) -->
    <!-- ============================= -->
    <div style="margin-top: 1rem;">

      <h2 style="margin-bottom: 0.5rem;">Model outputs</h2>

      <!-- List with both model predictions -->
      <ul style="list-style: none; padding: 0; margin: 0;">
        <li><strong>Random forest</strong> {{ random_rating or 5 }}</li>
        <li><strong>XGBoost</strong> {{ xgb_rating or 5 }}</li>
      </ul>

      <!-- Context clue -->
      <p class="muted" style="margin-top: 0.5rem; font-size: 0.9rem;">
        Ratings range from 1 (poor) to 5 (excellent).
      </p>
    </div>
  </section>

  <!-- ============================================ -->
  <!-- Optional: Table that shows all input values -->
  <!-- ============================================ -->
  {% if input_rows %}
  <section class="card export-card">
    <h2>Input data</h2>

    <table class="export-table" style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
      <tbody>

        <!-- Loop through each label/value pair -->
        {% for label, value in input_rows %}
        <tr>
          <!-- Left column: label -->
          <th scope="row"
              style="text-align: left; padding: 0.4rem 0.6rem;
                     border-bottom: 1px solid rgba(148, 163, 184, 0.4);">
            {{ label }}
          </th>

          <!-- Right column: value -->
          <td style="padding: 0.4rem 0.6rem;
                     border-bottom: 1px solid rgba(148, 163, 184, 0.4);">
            {{ value }}
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </section>
  {% endif %}

</main>

<!-- =========================================================== -->
<!-- Buttons appear on screen but WILL NOT appear in the PDF -->
<!-- =========================================================== -->
<section class="content-narrow">
  <div class="card export-card">
    <div class="actions" style="margin-top: 0.5rem;">

      <!-- Export Button → uses window.print() -->
      <button
        class="btn btn-primary"
        type="button"
        onclick="window.print()"
        title="Export this summary to PDF"
      >
        Export to PDF
      </button>

      <!-- Go back to form -->
      <a href="{{ url_for('rate.index') }}" class="btn">
        Rate another culvert
      </a>

    </div>
  </div>
</section>

{% endblock %}
